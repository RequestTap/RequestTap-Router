{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Receipt",
  "description": "RequestTap Router payment receipt",
  "type": "object",
  "required": [
    "request_id",
    "tool_id",
    "provider_id",
    "endpoint",
    "method",
    "timestamp",
    "price_usdc",
    "currency",
    "chain",
    "mandate_id",
    "mandate_hash",
    "mandate_verdict",
    "reason_code",
    "payment_tx_hash",
    "facilitator_receipt_id",
    "request_hash",
    "response_hash",
    "latency_ms",
    "outcome",
    "explanation"
  ],
  "properties": {
    "request_id": { "type": "string", "format": "uuid" },
    "tool_id": { "type": "string" },
    "provider_id": { "type": "string" },
    "endpoint": { "type": "string" },
    "method": { "type": "string", "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"] },
    "timestamp": { "type": "string", "format": "date-time" },
    "price_usdc": { "type": "string", "pattern": "^\\d+\\.\\d+$" },
    "currency": { "type": "string", "enum": ["USDC"] },
    "chain": { "type": "string" },
    "mandate_id": { "type": ["string", "null"] },
    "mandate_hash": { "type": ["string", "null"] },
    "mandate_verdict": { "type": "string", "enum": ["APPROVED", "DENIED", "SKIPPED"] },
    "reason_code": {
      "type": "string",
      "enum": [
        "OK",
        "MANDATE_BUDGET_EXCEEDED",
        "ENDPOINT_NOT_ALLOWLISTED",
        "MANDATE_EXPIRED",
        "RATE_LIMITED",
        "REPLAY_DETECTED",
        "UPSTREAM_ERROR_NO_CHARGE",
        "INVALID_SIGNATURE",
        "INVALID_PAYMENT",
        "ROUTE_NOT_FOUND",
        "SSRF_BLOCKED",
        "MANDATE_CONFIRM_REQUIRED",
        "INTERNAL_ERROR"
      ]
    },
    "payment_tx_hash": { "type": ["string", "null"] },
    "facilitator_receipt_id": { "type": ["string", "null"] },
    "request_hash": { "type": "string" },
    "response_hash": { "type": ["string", "null"] },
    "latency_ms": { "type": ["number", "null"] },
    "outcome": { "type": "string", "enum": ["SUCCESS", "DENIED", "ERROR", "REFUNDED"] },
    "explanation": { "type": "string" }
  },
  "additionalProperties": false
}
